// models/index.js - Versão FINAL CORRIGIDA (Pronta para o Render/Linux)

const { sequelize, testConnection } = require('../config/database'); 

// ====================================================
// 2. IMPORTAÇÃO DOS MODELOS (CORREÇÃO DE CASE SENSITIVE)
// ====================================================
// Nomes de arquivo devem ter a primeira letra em maiúsculo no require
const User = require('./User');
const Profile = require('./Profile');
const Game = require('./Game');
const UserGame = require('./UserGame');
const Review = require('./Review'); 

// ====================================================
// 3. DEFINE AS ASSOCIAÇÕES
// ====================================================

// Relação 1:1 Usuário <--> Perfil
User.hasOne(Profile, { foreignKey: 'UsuarioID', as: 'Perfil', onDelete: 'CASCADE' });
Profile.belongsTo(User, { foreignKey: 'UsuarioID' });

// Relação N:M Usuário <--> Jogo (Biblioteca/Favoritos)
User.belongsToMany(Game, { 
    through: UserGame, 
    foreignKey: 'fk_Usuarios_ID', 
    as: 'JogosFavoritos' 
});
Game.belongsToMany(User, { 
    through: UserGame, 
    foreignKey: 'fk_Jogos_ID', 
    as: 'UsuariosComJogo' 
});

// Relação 1:N (Reviews)
User.hasMany(Review, { foreignKey: 'UsuarioID', as: 'Avaliacoes' });
Review.belongsTo(User, { foreignKey: 'UsuarioID' }); // Review pertence a um Usuário
 
Game.hasMany(Review, { foreignKey: 'JogoID', as: 'Avaliacoes' });
Review.belongsTo(Game, { foreignKey: 'JogoID', as: 'Jogo' }); 

module.exports = {
    sequelize,
    testConnection,
    User,
    Profile,
    Game,
    UserGame,
    Review
};